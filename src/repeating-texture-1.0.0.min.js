Kiwi.Plugins.RepeatingTexture={name:"RepeatingTexture",version:"1.0.0"},Kiwi.PluginManager.register(Kiwi.Plugins.RepeatingTexture),"undefined"==typeof Kiwi.Plugins.GameObjects&&(Kiwi.Plugins.GameObjects={}),Kiwi.Plugins.GameObjects.RepeatingTexture=function(a,b,c,d,e,f){Kiwi.Entity.call(this,a,c,d),this.atlas=b,this._camera=null,this.lockedToCamera=!1,this.repeatX=!0,this.repeatY=!0,this._offset=new Kiwi.Geom.Point(0,0),this._cellOffset=new Kiwi.Geom.Point(0,0),this._width="undefined"==typeof e?this.atlas.cells[this.cellIndex].w:e,this._height="undefined"==typeof f?this.atlas.cells[this.cellIndex].h:f,this.game.renderOption===Kiwi.RENDERER_WEBGL&&(this.glRenderer=this.game.renderer.requestSharedRenderer("TextureAtlasRenderer"))},Kiwi.extend(Kiwi.Plugins.GameObjects.RepeatingTexture,Kiwi.Entity),Kiwi.Plugins.GameObjects.RepeatingTexture.prototype.objType=function(){return"RepeatingTexture"},Object.defineProperty(Kiwi.Plugins.GameObjects.RepeatingTexture.prototype,"camera",{get:function(){return this.lockedToCamera?this._camera:null},set:function(a){null==a||0==a?(this.lockedToCamera=!1,this._camera=null):(this.lockedToCamera=!0,this.x=0,this.y=0,this._camera=a)},enumerable:!0,configurable:!0}),Object.defineProperty(Kiwi.Plugins.GameObjects.RepeatingTexture.prototype,"width",{get:function(){return 0==this.repeatX?this.atlas.cells[this.cellIndex].w:this.lockedToCamera?this._camera.width:this._width},set:function(a){this._width=a},enumerable:!0,configurable:!0}),Object.defineProperty(Kiwi.Plugins.GameObjects.RepeatingTexture.prototype,"height",{get:function(){return 0==this.repeatY?this.atlas.cells[this.cellIndex].h:this.lockedToCamera?this._camera.height:this._height},set:function(a){this._height=a},enumerable:!0,configurable:!0}),Object.defineProperty(Kiwi.Plugins.GameObjects.RepeatingTexture.prototype,"cellOffsetX",{get:function(){return this._cellOffset.x},set:function(a){this._cellOffset.x=Kiwi.Utils.GameMath.wrap(a,this.atlas.cells[this.cellIndex].w,1)},enumerable:!0,configurable:!0}),Object.defineProperty(Kiwi.Plugins.GameObjects.RepeatingTexture.prototype,"cellOffsetY",{get:function(){return this._cellOffset.y},set:function(a){this._cellOffset.y=Kiwi.Utils.GameMath.wrap(a,this.atlas.cells[this.cellIndex].h,0)},enumerable:!0,configurable:!0}),Object.defineProperty(Kiwi.Plugins.GameObjects.RepeatingTexture.prototype,"offsetX",{get:function(){return this._offset.x},set:function(a){this._offset.x=a},enumerable:!0,configurable:!0}),Object.defineProperty(Kiwi.Plugins.GameObjects.RepeatingTexture.prototype,"offsetY",{get:function(){return this._offset.y},set:function(a){this._offset.y=a},enumerable:!0,configurable:!0}),Kiwi.Plugins.GameObjects.RepeatingTexture.prototype.update=function(){Kiwi.Entity.prototype.update.call(this),this.lockedToCamera&&(this.x=0-this.camera.transform.x,this.y=0-this.camera.transform.y)},Kiwi.Plugins.GameObjects.RepeatingTexture.prototype.render=function(a){if(1==this.visible&&this.alpha>0){var b=this.game.stage.ctx;b.save(),this.alpha>0&&this.alpha<=1&&(b.globalAlpha=this.alpha);{var c=this.transform,d=c.getConcatenatedMatrix();a.transform}b.transform(d.a,d.b,d.c,d.d,d.tx+c.rotPointX,d.ty+c.rotPointY),this.calculateCoordinates();for(var e=0;e<this._renderCoords.length;e+=8)b.drawImage(this.atlas.image,this._renderCoords[e],this._renderCoords[e+1],this._renderCoords[e+2],this._renderCoords[e+3],this._renderCoords[e+4]-c.rotPointX,this._renderCoords[e+5]-c.rotPointY,this._renderCoords[e+6],this._renderCoords[e+7]);b.restore()}},Kiwi.Plugins.GameObjects.RepeatingTexture.prototype.calculateCoordinates=function(){this._renderCoords=[];for(var a=this.atlas.cells[this.cellIndex],b=a.w,c=a.h,d=a.x,e=a.y,f=0;f<this.width;f+=b){b=f+a.w>this.width?a.w-(f+a.w-this.width):a.w,0!==this._cellOffset.x&&0===f?(b=a.w-this._cellOffset.x,d=a.x+(a.w-b),f+b>this.width&&(b=this.width-f)):d=a.x;for(var g=0;g<this.height;g+=c)c=g+a.h>this.height?a.h-(g+a.h-this.height):a.h,0!==this._cellOffset.y&&0===g?(c=a.h-this._cellOffset.y,e=a.y+(a.h-c),g+c>this.height&&(c=this.height-g)):e=a.y,this._renderCoords.push(d,e,b,c,f+this.offsetX,g+this.offsetY,b,c)}},Kiwi.Plugins.GameObjects.RepeatingTexture.prototype.renderGL=function(){if(0!=this.visible){var a=[],b=this.transform,c=b.getConcatenatedMatrix(),d=new Kiwi.Geom.Point(0-b.rotPointX,0-b.rotPointY),e=new Kiwi.Geom.Point(0-b.rotPointX,0-b.rotPointY),f=new Kiwi.Geom.Point(0-b.rotPointX,0-b.rotPointY),g=new Kiwi.Geom.Point(0-b.rotPointX,0-b.rotPointY);d=c.transformPoint(d),e=c.transformPoint(e),f=c.transformPoint(f),g=c.transformPoint(g);{this.atlas.cells[this.cellIndex]}this.calculateCoordinates();for(var h=0;h<this._renderCoords.length;h+=8)a.push(d.x+b.rotPointX+this._renderCoords[h+4],d.y+b.rotPointY+this._renderCoords[h+5],this._renderCoords[h],this._renderCoords[h+1],this.alpha,e.x+b.rotPointX+this._renderCoords[h+4]+this._renderCoords[h+6],e.y+b.rotPointY+this._renderCoords[h+5],this._renderCoords[h]+this._renderCoords[h+2],this._renderCoords[h+1],this.alpha,f.x+b.rotPointX+this._renderCoords[h+4]+this._renderCoords[h+6],f.y+b.rotPointY+this._renderCoords[h+5]+this._renderCoords[h+7],this._renderCoords[h]+this._renderCoords[h+2],this._renderCoords[h+1]+this._renderCoords[h+3],this.alpha,g.x+b.rotPointX+this._renderCoords[h+4],g.y+b.rotPointY+this._renderCoords[h+5]+this._renderCoords[h+7],this._renderCoords[h],this._renderCoords[h+1]+this._renderCoords[h+3],this.alpha);this.glRenderer.concatBatch(a)}};